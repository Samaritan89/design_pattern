# 动态类型语言和鸭子类型

编程语言按照*数据类型*可以分为两类

1. 静态类型语言
2. 动态类型语言

静态类型语言载入内存执行之前需要编译为可执行的二进制文件，在编译时段可以确定类型；动态类型语言执行之前不需要编译，一边解释一边执行，变量类型需要在程序运行时变量被赋值后才能确定。

动态类型语言并不是没有数据类型，而是数据类型直到变量被赋值后才能确定，被赋值的数据类型就是变量的类型。

## 优缺点

### 静态类型语言优点

1. 编译时就能发现类型不匹配错误，编译器可以帮我们在程序运行之前发现一些错误

2. 在程序中明确规定了数据类型，编译器可以针对这些信息做一些优化工作，提高程序运行速度

### 静态类型语言缺点

1. 迫使程序员依照强契约来编写程序，为每个变量规定数据类型归根到底只是辅助我们编写可靠性高程序的手段，而不是编写程序目的

2. 类型的声明会增加代码量和逻辑复杂度，会使程序员精力从业务逻辑上分散


### 动态类型语言优点

1. 编写代码数量少，看起来更简洁，程序员精力集中在业务逻辑

2. 没有类型约束，使用灵活

### 动态类型语言缺点

在程序运行之前无法保证变量的类型，从而在程序运行期间有可能发生和类型相关的错误。就好像在商店买了一包没有说明配料的牛肉辣条，只有吃到嘴里才知道是不是牛肉味


## duck typing

在JavaScript中当我们对一个变量赋值时，显然不需要考虑类型问题，JavaScript是一门典型的动态类型语言

动态类型语言对变量的宽裕给实际编码带来很大的灵活性。由于无需检测代码类型，我们可以尝试调用任何对象的任何方法，而无需考虑它原本是否被设计拥有该方法。

**面向接口编程**是设计模式的重要思想，但在JavaScript中由于弱类型的缘故，没有办法通过类型来约束对象行为，ES6之前甚至没有`Class`的概念。因此在JavaScript中实现设计模式的过程与我们熟悉的静态类型预览中的实现过程有很大差别。

首先要解决的就是类型识别问题，在静态类型语言中我们可以通过`interface`或者`class`来判读一个对象**IS-A** 某种type，而在JavaScript中我们更关注`HAS-A`，也就是关注对象的行为，而不是关注对象本身，这就是经典的 duck typing

> duck typing is a style of dynamic typing in which an object's current set of methods and properties determines the valid semantics, rather than its inheritance from a particular class or implementation of a specific interface.

duck typing 的通俗说法是：当它走起路来像鸭子，叫起来也是鸭子，那么就认为他是鸭子


有个小故事帮助我们理解duck typing

从前在JavaScript王国里，有一个国王，他认为世界上最美妙的声音就是鸭子的叫声，于是国王召集大臣，要组建一个1000只鸭子的合唱团。大臣们找遍了全国，终于找到了999只鸭子了，但是始终还差一只，最后大臣发现有一只非常特别的鸡，它的叫声和鸭子一模一样，于是这只鸡成了合唱团的最后一员

这个故事告诉我们，国王要听的只是鸭子的叫声，这个声音的主人是鸡还是鸭并不重要。

	var duck = {
        name: 'Frank',

        sing: function(){
            console.log('sing');
        }
    };

    var chicken = {
        name: 'Jack',

        sing: function(){
            console.log('sing');
        }
    };

    var choir = [];

    function joinChoir(animal){
        if(typeof animal.sing === 'function'){
            choir.push(animal);
            console.log('Choir length: ' + choir.length);
        }
    }

    joinChoir(duck);
    joinChoir(chicken);

我们可以看到，对于加入合唱团的动物，大臣无需检测它的类型，只需要保证它们拥有`sing`方法。在程序中对应的理解就是，当我们在某处需要某种类型的对象时，我们并不关心供消费的对象本身类型，实际在JavaScript中也没有类型，我们关系的时这个对象有没有我们需要的属性和方法，有的话，它就是我们需要的“鸭子”！

在静态类型语言中，要实现**面向接口编程**并不容易，往往需要借助抽象类或者这接口等将对象*向上转型*。当对象的真正类型被隐藏在起背后的它的超类型身后，这些对象才能被类型系统识别、相互替换使用，这样才能体现出对象多态的价值。

在动态语言的面向对象设计过程中，duck typing的概念至关重要，我们可以不必借助超类的帮助，轻松的在动态类型语言中实现一个原则：**面向接口编程**，而不是**面向实现编程**。

例如，一个对象如果正确实现了`pop`和`push`方法，我们可以不在乎起类型，就当做栈来使用
